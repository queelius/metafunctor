<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://unpkg.com/lunr/lunr.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Computational Statistics - SIUe - STAT 575 - Problem Set 2 | metafunctor</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="This problem set covers the E-M algorithm for right-censored normal data with known variance.">
    <meta name="generator" content="Hugo 0.139.3">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    
      <meta name="author" content = "Alex Towell (lex@metafunctor.com)">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']]      
    }
  };
</script>
        
    
    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/probsets/stat575/stat575-problem-set-2/">
    

    <meta property="og:url" content="http://localhost:1313/probsets/stat575/stat575-problem-set-2/">
  <meta property="og:site_name" content="metafunctor">
  <meta property="og:title" content="Computational Statistics - SIUe - STAT 575 - Problem Set 2">
  <meta property="og:description" content="This problem set covers the E-M algorithm for right-censored normal data with known variance.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="probsets">
    <meta property="article:published_time" content="2021-10-30T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-10-30T00:00:00+00:00">
    <meta property="article:tag" content="Statistics">
    <meta property="article:tag" content="R">
    <meta property="article:tag" content="Computation">
    <meta property="article:tag" content="EM Algorithm">
    <meta property="article:tag" content="Statistical Inference">

  <meta itemprop="name" content="Computational Statistics - SIUe - STAT 575 - Problem Set 2">
  <meta itemprop="description" content="This problem set covers the E-M algorithm for right-censored normal data with known variance.">
  <meta itemprop="datePublished" content="2021-10-30T00:00:00+00:00">
  <meta itemprop="dateModified" content="2021-10-30T00:00:00+00:00">
  <meta itemprop="wordCount" content="2956">
  <meta itemprop="keywords" content="Statistics,R,Computation,EM Algorithm,Statistical Inference">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Computational Statistics - SIUe - STAT 575 - Problem Set 2">
  <meta name="twitter:description" content="This problem set covers the E-M algorithm for right-censored normal data with known variance.">

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        metafunctor
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/social/" title="Social page">
              Social
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About Me page">
              About Me
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/ghprojects/" title="GitHub Projects page">
              GitHub Projects
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/posts/" title="News page">
              News
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/probsets/" title="Problem Sets page">
              Problem Sets
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/projects/" title="Projects page">
              Projects
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/publications/" title="Publications page">
              Publications
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/research/" title="Research page">
              Research
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/search/" title="Search page">
              Search
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        STAT 575 - Computational Statistics - SIUe - Summer 2021
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Computational Statistics - SIUe - STAT 575 - Problem Set 2</h1>
      
      <p class="tracked">
        By <strong>Alex Towell (<a href="mailto:lex@metafunctor.com">lex@metafunctor.com</a>)</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2021-10-30T00:00:00Z">October 30, 2021</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id="problem-1">Problem 1</h1>
<p>Derive the E-M algorithm for right-censored normal data with known variance, say $2 = 1$. Consider $Y_i$â€™s that are i.i.d. from a $N(\theta, 1)$, $i=1,2\ldots, n$. We observe $(x_1, \ldots, x_n)$ and $(\delta_1, \ldots, \delta_n)$, where $x_i = \min(y_i,c)$, and $\delta_i = I(y_i &lt; c)$. Let $C$ be the total number of censored (incomplete) observations. We denote the missing data as ${Z_i : \delta_i = 0}$.</p>
<h2 id="part-a">Part (a)</h2>
<p>Derive the complete log-likelihood, $\ell(\theta | Y)$.</p>
<h3 id="solution">Solution</h3>
$$
  Y_i \sim f_{Y_i}(y | \theta)
$$$$
  f_{Y_i}(y | \theta) = (2 \pi)^{-\frac{1}{2}} \exp\left(-\frac{1}{2}(y - \theta)^2\right).
$$$$
\begin{align*}
  L(\theta | \{y_i\})
    &= \prod_{i=1}^{n} (2 \pi)^{-\frac{1}{2}} \exp\left(-\frac{1}{2}(y_i - \theta)^2\right)\\
    &= (2 \pi)^{-\frac{n}{2}} \exp\left(-\sum_{i=1}^{n} \frac{1}{2}(y_i - \theta)^2\right).
\end{align*}
$$$$
\begin{align*}
  \ell(\theta | \{y_i\})
    &= \log L(\theta | \{y_i\})\\
    &= -\frac{n}{2} \log (2 \pi) - \frac{1}{2} \sum_{i=1}^{n} (y_i - \theta)^2\\
    &= -\frac{n}{2} \log (2 \pi) - \frac{1}{2} \sum_{i=1}^{n} y_i^2 + \theta \sum_{i=1}^{n} y_i - \frac{n}{2} \theta^2.
\end{align*}
$$$$
  \ell(\theta | \{y_i\}) = k + \theta \sum_{i=1}^{n} y_i - \frac{n}{2} \theta^2.
$$<h2 id="part-b">Part (b)</h2>
$$
  E(Y | x, \delta=1, \theta^{(t)}) = x
$$$$
  E(Y | x, \delta=0, \theta^{(t)}) = E(Y | Y > x) = \theta^{(t)} + \frac{\phi(x-\mu)}{1 - \Phi(x-\mu)}
$$<p>
where $\phi$ and $\Phi$ are pdf and cdf of standard normal.</p>
<h3 id="solution-1">Solution</h3>
<p>The distribution of $Y$ given $\delta = 1$, is uncensored
and therefore it is given that $Y$ realized the value $x$.
Since the expectation of a constant $x$ is $x$, that means
$E(Y | Y = x) = x$.</p>
<p>If $\delta = 0$, $Y$ is censored, i.e., $Y &gt; x$.
To take its expectation, we first need to derive the conditional conditional distribution of $Y$ given $Y &gt; x$ and $\theta^{(t)}$.</p>
$$
  \Pr(Y \leq y | Y > x) = \Pr(x < Y \leq y) / \Pr(Y > x)
$$$$
  \Pr(Y \leq y | Y > x) = \frac{F_Y(y | \theta^{(t)}) - F_Y(x | \theta^{(t)})}{1 - F_Y(y | \theta^{(t)})}.
$$<p>
where $F_{Y|\theta^{(t)}}$ is the cdf of the normal distribution with $\sigma=1$ and $\mu=\theta^{(t)}$.</p>
$$
  F_{Y}(y|\theta^{(t)}) = \Phi(y - \theta^{(t)}),
$$$$
  \Pr(Y \leq y | Y > x) = \frac{\Phi(y - \theta^{(t)}) - \Phi(x - \theta^{(t)})}{1 - \Phi(x - \theta^{(t)})}
$$$$
    F_{Y|x}(y|\theta^{(t)}) = 1 - \frac{1- \Phi(y - \theta^{(t)})}{1 - \Phi(x - \theta^{(t)})}
$$$$
    f_{Y}(y|x,\theta^{(t)}) = \frac{\phi(y - \theta^{(t)})}{1 - \Phi(x - \theta^{(t)})} I(y > x).
$$$$
\begin{align*}
  E(Y|x,\theta^{(t)})
    &= \int_{x}^{\infty} y f_{Y}(y|x,\theta^{(t)}) dy\\
    &= \int_{x}^{\infty} y \left(\frac{\phi(y - \theta^{(t)})}{1 - \Phi(x - \theta^{(t)})}\right) dy\\
    &= \frac{1}{{1 - \Phi(x - \theta^{(t)})}}\int_{x}^{\infty} y \phi(y - \theta^{(t)}) dy.
\end{align*}
$$<p>Analytically, this is a tricky integration problem.
Certainly, it would be trivial to numerically integrate this to obtain a solution, but we seek a closed-form solution.</p>
<p>I searched online, and discovered an interesting way to tackle this integration problem.</p>
$$
  \frac{df}{dy} = -(y - \theta) f(y)
$$$$
  \int_{a}^{b} \frac{df}{dy} dy = f(b) - f(a).
$$$$
\begin{align*}
  E(Y|x,\theta^{(t)})
    &= \frac{1}{1 - F(x)}\int_{x}^{\infty} y f(y) dy\\
    &= -\frac{1}{1 - F(x)}\int_{x}^{\infty} - (y -\theta^{(t)}) f(y) dy + \frac{\theta^{(t)}}{1-F(x)}\int_{x}^{\infty} f(y) dy\\
    &= -\frac{1}{1 - F(x)}\int_{x}^{\infty} \frac{df}{dy} dy + \frac{\theta^{(t)}}{1-F(x)} (1-F(x))\\
    &= -\frac{1}{1 - F(x)}\left(f(\infty) - f(x)\right) + \theta^{(t)}\\
    &= \frac{f(x)}{1 - F(x)} + \theta^{(t)}.
\end{align*}
$$$$
  E(Y|x,\theta^{(t)}) = \theta^{(t)} + \frac{\phi(x-\theta^{(t)})}{1 - \Phi(x-\theta^{(t)})}.
$$<h2 id="part-c">Part (c)</h2>
<p>Derive the $E$-step and $M$-step using parts (a) and (b). Give the updating equation.</p>
<h3 id="solution-2">Solution</h3>
<h4 id="e-step">E-step</h4>
<p>The $E$-step entails taking the conditional expectation of the complete log-likelihood function $\ell(\theta | {Y_i})$ given the observed data ${x_i}$ and ${\delta_i}$.</p>
$$
\begin{align*}
  Q(\theta | \theta^{(t)})
    &= E_{Y_i | x_i,\delta_i}(\ell(\theta | \{Y_i\})\\
    &= E_{Y_i | x_i,\delta_i}\left(k + \theta \sum_{i=1}^{n} Y_i - \frac{n}{2} \theta^2\right)\\
    &= k - \frac{n}{2}\theta^2 + \theta \sum_{i=1}^{n} E_{Y_i | x_i,\delta_i}(Y_i).
\end{align*}
$$$$
  Q(\theta | \theta^{(t)}) = k - \frac{n}{2}\theta^2 + \theta \sum_{i=1}^{n} \delta_i x_i + (1-\delta_i) \left(\theta^{(t)} + \frac{\phi(x_i-\theta^{(t)})}{1 - \Phi(x_i-\theta^{(t)})}\right).
$$$$
  Q(\theta | \theta^{(t)}) = k - \frac{n}{2}\theta^2 + C \theta \theta^{(t)} + R \theta
    + \theta \sum_{i=1}^{n} \frac{(1-\delta_i)\phi(x_i-\theta^{(t)})}{1 - \Phi(x_i-\theta^{(t)})}.
$$<h4 id="m-step">M-step</h4>
$$
  \theta^{(t+1)} = \arg\max_{\theta} Q(\theta | \theta^{(t)}).
$$$$
  \frac{d Q(\theta | \theta^{(t)})}{d \theta}\Biggr|_{\theta=\theta^{(t+1)}} = 0,
$$$$
  -n\theta^{(t+1)} + C \theta^{(t)} + R + \sum_{i=1}^{n} \frac{(1-\delta_i)\phi(x_i-\theta^{(t)})}{1 - \Phi(x_i-\theta^{(t)})} = 0.
$$$$
  \theta^{(t+1)} = \frac{R}{n} + \frac{C}{n} \theta^{(t)} + \frac{1}{n}\sum_{i=1}^{n}\frac{(1-\delta_i)\phi(x_i-\theta^{(t)})}{1 - \Phi(x_i-\theta^{(t)})}.
$$$$
  R = \sum_{i=1}^{n} \delta_i x_i
$$$$
  C = \sum_{i=1}^{n} (1-\delta_i).
$$<h2 id="part-d">Part (d)</h2>
<p>Use your algorithm on the V.A. data to find the MLE of $\mu$. Take the log of the event times first and standardize by sample standard deviation. You may simply use the censored data sample mean as your starting value.</p>
<h3 id="solution-3">Solution</h3>
<p>In the following R code, we implement the updating equation derived in the previous step. We encapulsate the procedure into a function that takes its arguments in
the form of a censored set, uncensorted set, starting value ($\theta^{(1)}$), and an $\epsilon$ value to control stopping condition.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># assuming the uncensored and censored data are distributed normally,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># we use the EM algorithm to derive an estimator given censored and uncensored</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># data.</span>
</span></span><span style="display:flex;"><span>mean_normal_censored_estimator_em <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(uncensored,censored,theta,eps<span style="color:#f92672">=</span><span style="color:#ae81ff">1e-6</span>,debug<span style="color:#f92672">=</span>T)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  dev <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sd</span>(<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">c</span>(uncensored,censored)))
</span></span><span style="display:flex;"><span>  censored <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">log</span>(censored) <span style="color:#f92672">/</span> dev
</span></span><span style="display:flex;"><span>  uncensored <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">log</span>(uncensored) <span style="color:#f92672">/</span> dev
</span></span><span style="display:flex;"><span>  theta <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">log</span>(theta) <span style="color:#f92672">/</span> dev
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  n <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">length</span>(censored) <span style="color:#f92672">+</span> <span style="color:#a6e22e">length</span>(uncensored)
</span></span><span style="display:flex;"><span>  C <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">length</span>(censored)
</span></span><span style="display:flex;"><span>  R <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sum</span>(uncensored)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  s <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(theta)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    sum <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>C)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      num <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dnorm</span>(censored[i],mean<span style="color:#f92672">=</span>theta,sd<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>      denom <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">pnorm</span>(censored[i],mean<span style="color:#f92672">=</span>theta,sd<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>      sum <span style="color:#f92672">&lt;-</span> sum <span style="color:#f92672">+</span> (num <span style="color:#f92672">/</span> denom)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    sum
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  i <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">repeat</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    theta.new <span style="color:#f92672">&lt;-</span> R<span style="color:#f92672">/</span>n <span style="color:#f92672">+</span> C<span style="color:#f92672">/</span>n <span style="color:#f92672">*</span> theta <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>n)<span style="color:#f92672">*</span><span style="color:#a6e22e">s</span>(theta)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (debug<span style="color:#f92672">==</span>T) { <span style="color:#a6e22e">cat</span>(<span style="color:#e6db74">&#34;theta[&#34;</span>, i, <span style="color:#e6db74">&#34;] =&#34;</span>,theta,<span style="color:#e6db74">&#34;, theta[&#34;</span>, i<span style="color:#ae81ff">+1</span>, <span style="color:#e6db74">&#34;] =&#34;</span>,theta.new,<span style="color:#e6db74">&#34;\n&#34;</span>) }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">abs</span>(theta.new <span style="color:#f92672">-</span> theta) <span style="color:#f92672">&lt;</span> eps)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      theta <span style="color:#f92672">&lt;-</span> theta.new <span style="color:#f92672">*</span> dev
</span></span><span style="display:flex;"><span>      theta <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">exp</span>(theta)
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>(theta)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">&lt;-</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    theta <span style="color:#f92672">&lt;-</span> theta.new
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We apply this procedure to the indicated data set.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(MASS) <span style="color:#75715e"># has VA data</span>
</span></span><span style="display:flex;"><span>VAs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">subset</span>(VA,prior<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>censored <span style="color:#f92672">&lt;-</span> VAs<span style="color:#f92672">$</span>status <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>censored_xs <span style="color:#f92672">&lt;-</span> VAs[censored,<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;stime&#34;</span>)]
</span></span><span style="display:flex;"><span>uncensored_xs <span style="color:#f92672">&lt;-</span> VAs[<span style="color:#f92672">!</span>censored,<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;stime&#34;</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mu <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mean</span>(uncensored_xs)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cat</span>(<span style="color:#e6db74">&#34;mean of the uncensored sample is &#34;</span>, mu, <span style="color:#e6db74">&#34;.&#34;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## mean of the uncensored sample is  112.1648 .
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>sol <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mean_normal_censored_estimator_em</span>(uncensored_xs,censored_xs,mu)
</span></span></code></pre></div><pre tabindex="0"><code>## theta[ 1 ] = 3.857928 , theta[ 2 ] = 3.424258 
## theta[ 2 ] = 3.424258 , theta[ 3 ] = 3.415443 
## theta[ 3 ] = 3.415443 , theta[ 4 ] = 3.415286 
## theta[ 4 ] = 3.415286 , theta[ 5 ] = 3.415283 
## theta[ 5 ] = 3.415283 , theta[ 6 ] = 3.415283
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>sol
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 65.2625
</code></pre><p>We see that our estimate of $\theta$ is $\hat{\theta} = 65.2624985$. (The $\theta$ before transforming it to the appropriate scale was $3.415283$.)</p>
<p>This mean is somewhat lower than anticipated, which makes me suspect something is wrong with my updating equation. If I have the time, I will revisit it.</p>
<h1 id="problem-2">Problem 2</h1>
<p><img src="prob4.2.png" alt="Problem 4.2"></p>
<h2 id="solution-4">Solution</h2>
<h3 id="part-a-1">Part (a)</h3>
<p>There are $N=1500$ gay men in the survey sample where $X_i$ denotes the $i$-th persons response to the number of risky sexual encounters he had in the previous $30$ days.
Thus, we observe a sample $\vec{X} = (X_1,X_2,\ldots, X_N)$.</p>
<p>We assume there are $3$ groups in the population, denoted by $z=1$, $t=2$, and $p=3$. Group $1$ members report $0$ risky sexual encounters regardless of the truth where the probability of being a member of group $1$ is denoted by $\alpha$,</p>
<p>Group $2$ members accurately report risky sexual encounters and represent typical behavior where the probability of being a member of group $2$ is denoted by $\beta$. We assume this group&rsquo;s number of sexual encounters follows a poisson with mean $\mu$.</p>
<p>Group $3$ members accurately report risky sexual encounters and represent high-risk behavior where the probability of being a member of group $3$ is $\gamma = 1-\alpha-\beta$. We assume this group&rsquo;s number of sexual encounters follows a poisson with mean $\lambda$.</p>
$$
  X_i \sim f(x | \vec{\theta}) = \alpha I(x=0) +
    \beta \mathrm{Poi}(x | \mu) + (1-\alpha-\beta)\mathrm{Poi}(x | \lambda)
$$$$
  \vec{\theta} = (\alpha,\beta,\mu,\lambda)'.
$$$$
\begin{align*}
  X_i | Z_i &= 1 \sim I(x=0),\\
  X_i | Z_i &= 2 \sim \mathrm{Poi}(\mu),\\
  X_i | Z_i &= 3 \sim \mathrm{Poi}(\lambda),
\end{align*}
$$$$
  Z_i \sim f_{Z_i}(z_i | \vec{\theta}) = \Pr(Z_i=z_i) = 
  \begin{cases}
    \alpha                  & z_i = 1,\\
    \beta                   & z_i = 2,\\
    \gamma=1-\alpha-\beta   & z_i = 3,
  \end{cases}
$$$$
  f_{X_i,Z_i}(x_i,z_i | \vec{\theta}) =
    \alpha I(z_i = 1) + \beta \mathrm{Poi}(\mu) I(z_i = 2) + (1-\alpha-\beta) \mathrm{Poi}(\lambda) I(z_i=3).
$$$$
  \mathcal{L}(\vec{\theta} | \vec{X}, \vec{Z}) = \prod_{i=1}^{N} f_{X_i,Z_i}(x_i,z_i | \vec{\theta}),
$$$$
  \mathcal{L}(\vec{\theta} | \vec{X}, \vec{Z}) =
    \left(\prod_{\{i | z_i = 1\}} \alpha I(x_i=0)\right)
    \left(\prod_{\{i | z_i = 2\}} \beta \frac{\mu^{x_i} e^{-\mu}}{x_i!}\right)
    \left(\prod_{\{i | z_i = 3\}} \gamma \frac{\lambda^{x_i} e^{-\lambda}}{x_i!}\right).
$$$$
  \mathcal{L}(\vec{\theta} | \vec{X}, \vec{Z}) =
    \left(\prod_{\{i | z_i = 1, x_i = 0 \}} \alpha\right)
    \prod_{k=0}^{16} \left(\prod_{\{i | z_i = 2, x_i = k\}} \beta \frac{\mu^{k} e^{-\mu}}{k!}\right)
    \prod_{k=0}^{16} \left(\prod_{\{i | z_i = 3, x_i = k\}} \gamma \frac{\lambda^{k} e^{-\lambda}}{k!}\right).
$$$$
  \mathcal{L}(\vec{\theta} | \{n_{j,k}\}) =
    \alpha^{n_{1,0}}
    \prod_{k=0}^{16} \beta^{n_{2,k}} \frac{\mu^{k n_{2,k}} e^{-\mu n_{2,k}}}{(k!)^{n_{2,k}}}
    \prod_{k=0}^{16} \gamma^{n_{3,k}} \frac{\lambda^{k n_{3,k}} e^{-\lambda n_{3,k}}}{(k!)^{n_{3,k}}}
$$$$
  \ell(\vec{\theta} | \{n_{j,k}\}) =
    n_{1,0} \log \alpha +
    \sum_{k=0}^{16} \log \left(\beta^{n_{2,k}} \frac{\mu^{k n_{2,k}} e^{-\mu n_{2,k}}}{(k!)^{n_{2,k}}}\right) +
    \sum_{k=0}^{16} \log \left(\gamma^{n_{3,k}} \frac{\lambda^{k n_{3,k}} e^{-\lambda n_{3,k}}}{(k!)^{n_{3,k}}}\right)
$$$$
\begin{split}
  \ell(\vec{\theta} | \{n_{j,k}\}) =
    n_{1,0} \log \alpha +
    \sum_{k=0}^{16}
      &n_{2,k}(\log \beta + k \log \mu - \mu - \log k!) + \\
      &n_{3,k}(\log \gamma + k \log \lambda - \lambda - \log k!).
\end{split}
$$$$
  \ell(\vec{\theta} | \{n_{j,k}\}) = n_{1,0} \log \alpha +
    \sum_{k=0}^{16} \left\{ n_{2,k}(\log \beta + k \log \mu - \mu) + n_{3,k}(\log \gamma + k \log \lambda - \lambda) \right\}.
$$<h3 id="e-step-1">E-step</h3>
$$
  Q(\vec{\theta} | \vec{\theta}^{(t)}) = E(\ell(\vec{\theta}))
$$$$
Q(\vec{\theta} | \vec{\theta}^{(t)}) = E
  \left(
      n_{1,0} \log \alpha +
      \sum_{k=0}^{16} \left\{
        n_{2,k}(\log \beta + k \log \mu - \mu) +
        n_{3,k}(\log \gamma + k \log \lambda - \lambda)
        \right\}
  \right).
$$$$
Q(\vec{\theta} | \vec{\theta}^{(t)}) = E(n_{1,0}) \log \alpha +
  \sum_{k=0}^{16} \left\{
    E(n_{2,k})(\log \beta + k \log \mu - \mu) +
    E(n_{3,k})(\log \gamma + k \log \lambda - \lambda) \right\}
$$<p>
given ${n_j}$ and $\theta^{(t)}$.</p>
<p>Consider $E!\left(n_{2,k} | {n_j}, \theta^{(t)}\right)$.
To solve this expectation, we must first derive the distribution of $n_{2,k}$.</p>
$$
  \Pr(Z_j = 2 | x_j = k) = \Pr(Z_j = 2) \Pr(x_j = k | Z_j = 2) / \Pr(x_j = k).
$$<p>
We note that $\Pr(x_j = k)$ is equivalent to $\pi_k(\vec{\theta})$, $\Pr(Z_j = 2)$ is the definition of $\beta$, and $\Pr(x_j = k | Z_j = 2)$ is
$f_{X_j|Z_j}(k | Z_j=2) = \mathrm{Poi}(k | \mu)$.</p>
$$
  t_k(\vec{\theta}) = \Pr(Z_j = 2 | x_j = k) = \beta \mathrm{Poi}(k | \mu) / \pi_k(\vec{\theta}).
$$$$
  E(n_{2,k}) = n_k t_k(\vec{\theta}^{(t)}).
$$$$
  E(n_{3,k}) = n_k p_k(\vec{\theta}^{(t)})
$$$$
  E(n_{1,0}) = n_0 z_0(\vec{\theta}^{(t)}),
$$$$
Q(\vec{\theta} | \vec{\theta}^{(t)}) = n_0 z_0(\vec{\theta}^{(t)}) \log \alpha +
  \sum_{k=0}^{16} \left\{
    n_k t_k(\vec{\theta}^{(t)})(\log \beta + k \log \mu - \mu) +
    n_k p_k(\vec{\theta}^{(t)})(\log \gamma + k \log \lambda - \lambda) \right\}
$$<h3 id="m-step-1">M-step</h3>
$$
  \vec{\theta}^{(t+1)} = \argmax_{\vec{\theta}} Q(\vec{\theta} | \vec{\theta}^{(t)}).
$$$$
  \nabla Q(\vec{\theta} | \vec{\theta}^{(t)})\Bigr|_{\vec{\theta}=\vec{\theta}^{(t+1)}} = \vec{0}.
$$$$
  Q_l(\vec{\theta},c | \vec{\theta}^{(t)}) = Q(\vec{\theta} | \vec{\theta}^{(t)}) + c(1-\alpha-\beta-\gamma).
$$$$
  \frac{\partial Q_l}{\partial \alpha} = \frac{n_0 z_0(\theta^{(t)})}{\alpha} - c = 0,
$$$$
  \alpha^{(t+1)} = \frac{1}{c} n_0 z_0(\theta^{(t)}).
$$$$
  \beta^{(t+1)} = \frac{1}{c} \sum_{k=0}^{16} n_k t_k(\theta^{(t)}).
$$$$
  \gamma^{(t+1)} = \frac{1}{c} \sum_{k=0}^{16} n_k p_k(\theta^{(t)}).
$$$$
  n_0 z_0(\theta^{(t)}) + \sum_{k=0}^{16} n_k t_k(\theta^{(t)}) + \sum_{k=0}^{16} n_k p_k(\theta^{(t)}) = N.
$$$$
\begin{align*}
  \alpha^{(t+1)}    &= \frac{1}{N} n_0 z_0(\theta^{(t)})\\
  \beta^{(t+1)}     &= \frac{1}{N} \sum_{k=0}^{16} n_k t_k(\theta^{(t)})\\
  \gamma^{(t+1)}    &= \frac{1}{N} \sum_{k=0}^{16} n_k p_k(\theta^{(t)}).
\end{align*}
$$$$
\begin{align*}
  \frac{\partial Q_l}{\partial \mu}\biggr|_{\mu=\mu^{(t+1}} &= 0\\
  \sum_{k=0}^{16} n_k t_k(\theta^{(t)})(k/\mu^{(t+1)}-1)           &= 0\\
  \frac{1}{\mu^{(t+1)}} \sum_{k=0}^{16} n_k t_k(\theta^{(t)}) k    &= \sum_{k=0}^{16} n_k t_k(\theta^{(t)})\\
  \mu^{(t+1)} &= \frac{\sum_{k=0}^{16} k n_k t_k(\theta^{(t)})}{\sum_{k=0}^{16} n_k t_k(\theta^{(t)})}.
\end{align*}
$$$$
  \lambda^{(t+1)} = \frac{\sum_{k=0}^{16} k n_k p_k(\theta^{(t)})}{\sum_{k=0}^{16} n_k p_k(\theta^{(t)})}.
$$<h2 id="part-b-1">Part (b)</h2>
<p>Estimate the parameters of the model, using the observed data.</p>
<h3 id="solution-5">Solution</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># we observe n = (n0,n1,...,n16)</span>
</span></span><span style="display:flex;"><span>ns <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">379</span>,<span style="color:#ae81ff">299</span>,<span style="color:#ae81ff">222</span>,<span style="color:#ae81ff">145</span>,<span style="color:#ae81ff">109</span>,<span style="color:#ae81ff">95</span>,<span style="color:#ae81ff">73</span>,<span style="color:#ae81ff">59</span>,<span style="color:#ae81ff">45</span>,<span style="color:#ae81ff">30</span>,<span style="color:#ae81ff">24</span>,<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sum</span>(ns)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># theta := (alpha, beta, mu, lambda)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># note that there is an implicit parameter gamma s.t.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># alpha + beta + gamma = 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the initial value assumes each category z, t, or p</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># is equally probable, and so we let</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     (alpha^(0),beta^(0)) = (1/3,1/3)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and mu^(0) and lambda^(0) are just arbitrarily chosen to be 2 and 3,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># with the insight that group 3 is more risky than group 2.</span>
</span></span><span style="display:flex;"><span>theta <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># theta := (alpha, beta, mu, lambda)</span>
</span></span><span style="display:flex;"><span>Pi <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(i,theta)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  res <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">&lt;-</span> theta[1]
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  res <span style="color:#f92672">&lt;-</span> res <span style="color:#f92672">+</span> theta[2] <span style="color:#f92672">*</span> theta[3]^i <span style="color:#f92672">*</span> <span style="color:#a6e22e">exp</span>(<span style="color:#f92672">-</span>theta[3])
</span></span><span style="display:flex;"><span>  res <span style="color:#f92672">&lt;-</span> res <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> theta[1] <span style="color:#f92672">-</span> theta[2]) <span style="color:#f92672">*</span> theta[4]^i <span style="color:#f92672">*</span> <span style="color:#a6e22e">exp</span>(<span style="color:#f92672">-</span>theta[4])
</span></span><span style="display:flex;"><span>  res
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>z0 <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(theta)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  theta[1] <span style="color:#f92672">/</span> <span style="color:#a6e22e">Pi</span>(<span style="color:#ae81ff">0</span>,theta)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>t <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(i,theta)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  theta[2] <span style="color:#f92672">*</span> theta[3]^i <span style="color:#f92672">*</span> <span style="color:#a6e22e">exp</span>(<span style="color:#f92672">-</span>theta[3]) <span style="color:#f92672">/</span> <span style="color:#a6e22e">Pi</span>(i,theta)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(i,theta)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  (<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>theta[1] <span style="color:#f92672">-</span> theta[2]) <span style="color:#f92672">*</span> theta[4]^i <span style="color:#f92672">*</span> <span style="color:#a6e22e">exp</span>(<span style="color:#f92672">-</span>theta[4]) <span style="color:#f92672">/</span> <span style="color:#a6e22e">Pi</span>(i,theta)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># update algorithm, based on EM algorithm</span>
</span></span><span style="display:flex;"><span>update <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(theta,ns)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># note: n0 := ns[1] instead of ns[0] since R does not use zero-based indexes</span>
</span></span><span style="display:flex;"><span>  alpha <span style="color:#f92672">&lt;-</span> ns[1] <span style="color:#f92672">*</span> <span style="color:#a6e22e">z0</span>(theta) <span style="color:#f92672">/</span> N
</span></span><span style="display:flex;"><span>  beta <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  mu_num <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  mu_denom <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  lam_num <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  lam_denom <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    ti <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">t</span>(i,theta)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pi</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">p</span>(i,theta)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    beta <span style="color:#f92672">&lt;-</span> beta <span style="color:#f92672">+</span> ns[i<span style="color:#ae81ff">+1</span>] <span style="color:#f92672">*</span> ti
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    mu_num <span style="color:#f92672">&lt;-</span> mu_num <span style="color:#f92672">+</span> i <span style="color:#f92672">*</span> ns[i<span style="color:#ae81ff">+1</span>] <span style="color:#f92672">*</span> ti
</span></span><span style="display:flex;"><span>    mu_denom <span style="color:#f92672">&lt;-</span> mu_denom <span style="color:#f92672">+</span> ns[i<span style="color:#ae81ff">+1</span>] <span style="color:#f92672">*</span> ti
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    lam_num <span style="color:#f92672">&lt;-</span> lam_num <span style="color:#f92672">+</span> i <span style="color:#f92672">*</span> ns[i<span style="color:#ae81ff">+1</span>] <span style="color:#f92672">*</span> <span style="color:#66d9ef">pi</span>
</span></span><span style="display:flex;"><span>    lam_denom <span style="color:#f92672">&lt;-</span> lam_denom <span style="color:#f92672">+</span> ns[i<span style="color:#ae81ff">+1</span>] <span style="color:#f92672">*</span> <span style="color:#66d9ef">pi</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  beta <span style="color:#f92672">&lt;-</span> beta <span style="color:#f92672">/</span> N
</span></span><span style="display:flex;"><span>  mu <span style="color:#f92672">&lt;-</span> mu_num <span style="color:#f92672">/</span> mu_denom
</span></span><span style="display:flex;"><span>  lam <span style="color:#f92672">&lt;-</span> lam_num <span style="color:#f92672">/</span> lam_denom
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(alpha,beta,mu,lam)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>em <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(theta,ns,steps<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>,debug<span style="color:#f92672">=</span>T)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span>(i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>steps)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    theta <span style="color:#f92672">=</span> <span style="color:#a6e22e">update</span>(theta,ns)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (debug<span style="color:#f92672">==</span>T)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">%%</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) { <span style="color:#a6e22e">cat</span>(<span style="color:#e6db74">&#34;iteration =&#34;</span>,i,<span style="color:#e6db74">&#34; theta = (&#34;</span>,theta,<span style="color:#e6db74">&#34;)&#39;\n&#34;</span>) }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  theta
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># solution theta = (alpha, beta, mu, lambda)</span>
</span></span><span style="display:flex;"><span>sol <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">em</span>(theta,ns,<span style="color:#ae81ff">10000</span>,T)
</span></span></code></pre></div><pre tabindex="0"><code>## iteration = 1000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
## iteration = 2000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
## iteration = 3000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
## iteration = 4000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
## iteration = 5000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
## iteration = 6000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
## iteration = 7000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
## iteration = 8000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
## iteration = 9000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
## iteration = 10000  theta = ( 0.1221661 0.5625419 1.467475 5.938889 )&#39;
</code></pre><p>We see that the solution is $0.1221661, 0.5625419, 1.4674746, 5.9388889$.</p>
<h2 id="part-c-1">Part (c)</h2>
<p>Estimate the standard errors and pairwise correlations of your parameters, using any available method.</p>
<h3 id="solution-6">Solution</h3>
<p>We have chosen to use the Bootstrap method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># ns = (379,299,222,145,109,95,73,59,45,30,24,12,4,2,0,1,1)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 379 responded 0 encounters</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 299 responded 1 encounters</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 222 responded 2 encounters</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 responded 16 encounters</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to resample, we resample from the data set that includes each</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># persons response, as determined by ns.</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(ns))
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">append</span>(data,<span style="color:#a6e22e">rep</span>((i<span style="color:#ae81ff">-1</span>),ns[i]))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>make_into_counts <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(data)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  ns <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    ni <span style="color:#f92672">&lt;-</span> data[data <span style="color:#f92672">==</span> i]
</span></span><span style="display:flex;"><span>    l <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">length</span>(ni)
</span></span><span style="display:flex;"><span>    ns <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">append</span>(ns,l)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  ns
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1000</span> <span style="color:#75715e"># bootstrap replicates</span>
</span></span><span style="display:flex;"><span>em_steps <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>theta.bs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">em</span>(theta,ns,em_steps,F)
</span></span><span style="display:flex;"><span>thetas <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(theta.bs)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span>m)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  indices <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sample</span>(N,N,replace<span style="color:#f92672">=</span>T)
</span></span><span style="display:flex;"><span>  resampled <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">make_into_counts</span>(data[indices])
</span></span><span style="display:flex;"><span>  theta.bs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">em</span>(theta,resampled,em_steps,F)
</span></span><span style="display:flex;"><span>  thetas <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(thetas,theta.bs)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">%%</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cat</span>(<span style="color:#e6db74">&#34;iteration &#34;</span>, i, <span style="color:#e6db74">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">cov</span>(thetas))
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><pre tabindex="0"><code>## iteration  100 
##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0004197254 -0.0001718468 0.0017266699 0.001591205
## [2,] -0.0001718468  0.0005295261 0.0002895402 0.001980314
## [3,]  0.0017266699  0.0002895402 0.0131179548 0.015108087
## [4,]  0.0015912053  0.0019803141 0.0151080872 0.047009875
## iteration  200 
##               [,1]          [,2]         [,3]       [,4]
## [1,]  0.0003864557 -1.678292e-04 1.590662e-03 0.00154358
## [2,] -0.0001678292  4.671077e-04 9.764038e-05 0.00133111
## [3,]  0.0015906622  9.764038e-05 1.228480e-02 0.01297749
## [4,]  0.0015435804  1.331110e-03 1.297749e-02 0.03894848
## iteration  300 
##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003735625 -1.785107e-04 1.479671e-03 0.001351610
## [2,] -0.0001785107  4.678372e-04 6.137843e-06 0.001259075
## [3,]  0.0014796708  6.137843e-06 1.123608e-02 0.011748534
## [4,]  0.0013516098  1.259075e-03 1.174853e-02 0.036388361
## iteration  400 
##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003625489 -0.0001755464 0.0014276201 0.001221715
## [2,] -0.0001755464  0.0004540625 0.0000184334 0.001288138
## [3,]  0.0014276201  0.0000184334 0.0110764497 0.010780774
## [4,]  0.0012217155  0.0012881380 0.0107807741 0.034067537
## iteration  500 
##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003718052 -0.0001842823 0.0014502414 0.001310802
## [2,] -0.0001842823  0.0004847405 0.0001080019 0.001398247
## [3,]  0.0014502414  0.0001080019 0.0114792580 0.011828494
## [4,]  0.0013108018  0.0013982467 0.0118284941 0.036489243
## iteration  600 
##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003791435 -1.814512e-04 1.497719e-03 0.001364054
## [2,] -0.0001814512  4.674232e-04 7.293112e-05 0.001410218
## [3,]  0.0014977193  7.293112e-05 1.157800e-02 0.011903853
## [4,]  0.0013640538  1.410218e-03 1.190385e-02 0.037292937
## iteration  700 
##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003819013 -1.782221e-04 1.521678e-03 0.001410964
## [2,] -0.0001782221  4.546723e-04 8.545081e-05 0.001405131
## [3,]  0.0015216781  8.545081e-05 1.178236e-02 0.012322621
## [4,]  0.0014109640  1.405131e-03 1.232262e-02 0.037738946
## iteration  800 
##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003730646 -0.0001676221 0.0015068905 0.001443218
## [2,] -0.0001676221  0.0004405397 0.0001354924 0.001470624
## [3,]  0.0015068905  0.0001354924 0.0118808619 0.012889971
## [4,]  0.0014432180  0.0014706239 0.0128899710 0.038858338
## iteration  900 
##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003676784 -0.0001699529 0.0014571801 0.001358486
## [2,] -0.0001699529  0.0004554077 0.0001823193 0.001590474
## [3,]  0.0014571801  0.0001823193 0.0117524614 0.012790632
## [4,]  0.0013584862  0.0015904740 0.0127906324 0.039055305
## iteration  1000 
##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003697739 -0.0001652985 0.0014912066 0.001367237
## [2,] -0.0001652985  0.0004523873 0.0002111503 0.001638727
## [3,]  0.0014912066  0.0002111503 0.0120934727 0.013311533
## [4,]  0.0013672372  0.0016387267 0.0133115328 0.039376614
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>cov.bs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cov</span>(thetas)
</span></span><span style="display:flex;"><span>cor.bs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cor</span>(thetas)
</span></span></code></pre></div><p>The Bootstrap estimator of the covariance matrix is given by</p>
<pre tabindex="0"><code>##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003697739 -0.0001652985 0.0014912066 0.001367237
## [2,] -0.0001652985  0.0004523873 0.0002111503 0.001638727
## [3,]  0.0014912066  0.0002111503 0.0120934727 0.013311533
## [4,]  0.0013672372  0.0016387267 0.0133115328 0.039376614
</code></pre><p>and the correlation matrix is given by</p>
<pre tabindex="0"><code>##            [,1]        [,2]       [,3]      [,4]
## [1,]  1.0000000 -0.40415269 0.70517057 0.3583080
## [2,] -0.4041527  1.00000000 0.09027364 0.3882685
## [3,]  0.7051706  0.09027364 1.00000000 0.6100050
## [4,]  0.3583080  0.38826847 0.61000496 1.0000000
</code></pre><p>Let&rsquo;s try using the Hessian of the observed information matrix.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(numDeriv)
</span></span><span style="display:flex;"><span>loglike <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(theta)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  s <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (x <span style="color:#66d9ef">in</span> data)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    s <span style="color:#f92672">&lt;-</span> s <span style="color:#f92672">+</span> <span style="color:#a6e22e">log</span>(theta[1]<span style="color:#f92672">*</span><span style="color:#a6e22e">as.numeric</span>(x<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                 theta[2]<span style="color:#f92672">*</span><span style="color:#a6e22e">dpois</span>(x,theta[3]) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                 (<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>theta[1]<span style="color:#f92672">-</span>theta[2])<span style="color:#f92672">*</span><span style="color:#a6e22e">dpois</span>(x,theta[4]))
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  s
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>mle <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.1221661</span>,<span style="color:#ae81ff">0.5625419</span>,<span style="color:#ae81ff">1.4674746</span>,<span style="color:#ae81ff">5.9388889</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">solve</span>(<span style="color:#f92672">-</span><span style="color:#a6e22e">hessian</span>(loglike,mle))
</span></span></code></pre></div><pre tabindex="0"><code>##               [,1]          [,2]         [,3]        [,4]
## [1,]  0.0003799048 -1.909698e-04 1.438556e-03 0.001184057
## [2,] -0.0001909698  4.657702e-04 7.132638e-05 0.001417409
## [3,]  0.0014385560  7.132638e-05 1.111722e-02 0.011376017
## [4,]  0.0011840568  1.417409e-03 1.137602e-02 0.034664940
</code></pre><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/statistics/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Statistics</a>
   </li>
  
   <li class="list di">
     <a href="/tags/r/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">R</a>
   </li>
  
   <li class="list di">
     <a href="/tags/computation/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Computation</a>
   </li>
  
   <li class="list di">
     <a href="/tags/em-algorithm/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">EM Algorithm</a>
   </li>
  
   <li class="list di">
     <a href="/tags/statistical-inference/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Statistical Inference</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
        <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "metafunctor-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/probsets/stat575/problem_set_4/">SIUe - Computational Statistics (STAT 575) - Problem Set 4</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2012-02-04-sax/cs584_sax_review/">Review: A Symbolic Representation of Time Series, with Implications for Streaming Algorithms</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/probsets/stat482/problem_set_8/">Regression Analysis - SIUe - STAT 482 - Probem Set 8</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  metafunctor 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
